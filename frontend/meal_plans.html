<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meal Plans - Bite Board</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .meal-plan-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .meal-plan-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 20px;
            margin-top: 20px;
        }

        .day-column {
            background: #fff;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .day-column h3 {
            text-align: center;
            margin-bottom: 15px;
            color: #333;
        }

        .meal-slot {
            background: #f5f5f5;
            border-radius: 4px;
            padding: 10px;
            margin-bottom: 10px;
        }

        .meal-slot h4 {
            margin: 0 0 5px 0;
            color: #666;
        }

        .meal-slot .meal-content {
            background: #e8f5e9;
            padding: 10px;
            border-radius: 4px;
            margin: 5px 0;
            position: relative;
        }

        .meal-slot .meal-content .delete-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: #f44336;
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            cursor: pointer;
            display: none;
        }

        .meal-slot .meal-content:hover .delete-btn {
            display: block;
        }

        .add-meal-form {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .add-meal-form select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            flex: 1;
        }

        .add-meal-form button {
            padding: 8px 16px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .add-meal-form button:hover {
            background: #45a049;
        }

        .message {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            display: none;
        }

        .message.success {
            background: #d4edda;
            color: #155724;
        }

        .message.error {
            background: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <a href="index.html" class="nav-brand">Bite Board</a>
        <div class="hamburger">
            <span></span>
            <span></span>
            <span></span>
        </div>
        <div class="nav-links">
            <a href="index.html">Home</a>
            <a href="favorites.html">My Favorites</a>
            <a href="journal.html">Recipe Journal</a>
            <a href="meal_plans.html" class="active">Meal Plans</a>
        </div>
    </nav>

    <div id="loginStatus" class="login-status">
        <span id="userDisplay"></span>
        <button type="button" onclick="logout()" class="logout-button">Logout</button>
    </div>

    <div class="container">
        <h1>My Meal Plan</h1>
        <p class="subtitle">Plan your meals for the entire week! Choose from your favorite recipes or journal entries to create a balanced meal plan. Organize breakfast, lunch, and dinner for each day, and make your meal preparation stress-free and delicious.</p>
        
        <div class="meal-plan-container">
            <h2>Meal Plan</h2>
            <div class="add-meal-form">
                <select id="recipeSelect">
                    <option value="">Select a recipe...</option>
                </select>
                <select id="daySelect">
                    <option value="Monday">Monday</option>
                    <option value="Tuesday">Tuesday</option>
                    <option value="Wednesday">Wednesday</option>
                    <option value="Thursday">Thursday</option>
                    <option value="Friday">Friday</option>
                    <option value="Saturday">Saturday</option>
                    <option value="Sunday">Sunday</option>
                </select>
                <select id="mealTypeSelect">
                    <option value="Breakfast">Breakfast</option>
                    <option value="Lunch">Lunch</option>
                    <option value="Dinner">Dinner</option>
                </select>
                <button onclick="addMealToPlan()">Add to Plan</button>
            </div>
            <div id="message" class="message" style="display: none;"></div>
            <div class="meal-plan-grid">
                <div class="day-column" id="Monday">
                    <h3>Monday</h3>
                    <div class="meal-slot" data-meal="Breakfast">
                        <h4>Breakfast</h4>
                    </div>
                    <div class="meal-slot" data-meal="Lunch">
                        <h4>Lunch</h4>
                    </div>
                    <div class="meal-slot" data-meal="Dinner">
                        <h4>Dinner</h4>
                    </div>
                </div>
                <div class="day-column" id="Tuesday">
                    <h3>Tuesday</h3>
                    <div class="meal-slot" data-meal="Breakfast">
                        <h4>Breakfast</h4>
                    </div>
                    <div class="meal-slot" data-meal="Lunch">
                        <h4>Lunch</h4>
                    </div>
                    <div class="meal-slot" data-meal="Dinner">
                        <h4>Dinner</h4>
                    </div>
                </div>
                <div class="day-column" id="Wednesday">
                    <h3>Wednesday</h3>
                    <div class="meal-slot" data-meal="Breakfast">
                        <h4>Breakfast</h4>
                    </div>
                    <div class="meal-slot" data-meal="Lunch">
                        <h4>Lunch</h4>
                    </div>
                    <div class="meal-slot" data-meal="Dinner">
                        <h4>Dinner</h4>
                    </div>
                </div>
                <div class="day-column" id="Thursday">
                    <h3>Thursday</h3>
                    <div class="meal-slot" data-meal="Breakfast">
                        <h4>Breakfast</h4>
                    </div>
                    <div class="meal-slot" data-meal="Lunch">
                        <h4>Lunch</h4>
                    </div>
                    <div class="meal-slot" data-meal="Dinner">
                        <h4>Dinner</h4>
                    </div>
                </div>
                <div class="day-column" id="Friday">
                    <h3>Friday</h3>
                    <div class="meal-slot" data-meal="Breakfast">
                        <h4>Breakfast</h4>
                    </div>
                    <div class="meal-slot" data-meal="Lunch">
                        <h4>Lunch</h4>
                    </div>
                    <div class="meal-slot" data-meal="Dinner">
                        <h4>Dinner</h4>
                    </div>
                </div>
                <div class="day-column" id="Saturday">
                    <h3>Saturday</h3>
                    <div class="meal-slot" data-meal="Breakfast">
                        <h4>Breakfast</h4>
                    </div>
                    <div class="meal-slot" data-meal="Lunch">
                        <h4>Lunch</h4>
                    </div>
                    <div class="meal-slot" data-meal="Dinner">
                        <h4>Dinner</h4>
                    </div>
                </div>
                <div class="day-column" id="Sunday">
                    <h3>Sunday</h3>
                    <div class="meal-slot" data-meal="Breakfast">
                        <h4>Breakfast</h4>
                    </div>
                    <div class="meal-slot" data-meal="Lunch">
                        <h4>Lunch</h4>
                    </div>
                    <div class="meal-slot" data-meal="Dinner">
                        <h4>Dinner</h4>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        // Load recipes and meal plans when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            loadRecipes();
            loadMealPlans();
        });

        // Load all recipes for the dropdown
        function loadRecipes() {
            const currentUser = localStorage.getItem('currentUser');
            if (!currentUser) {
                alert('Please log in to view recipes');
                return;
            }

            const select = document.getElementById('recipeSelect');
            select.innerHTML = '<option value="">Select a recipe...</option>';

            // Load favorites
            fetch('http://localhost:8000/api/favorites.php?action=get')
                .then(response => response.json())
                .then(favorites => {
                    favorites.forEach(favorite => {
                        const option = document.createElement('option');
                        option.value = favorite.recipe_id;
                        option.textContent = `â­ ${favorite.recipe_name}`;
                        select.appendChild(option);
                    });

                    // Load journal entries
                    return fetch('http://localhost:8000/api/journal.php?action=get');
                })
                .then(response => response.json())
                .then(journalEntries => {
                    journalEntries.forEach(entry => {
                        const option = document.createElement('option');
                        option.value = entry.recipe_id;
                        option.textContent = `ðŸ“ ${entry.recipe_name}`;
                        select.appendChild(option);
                    });
                })
                .catch(error => console.error('Error loading recipes:', error));
        }

        // Load meal plans for the current user
        function loadMealPlans() {
            const currentUser = localStorage.getItem('currentUser');
            if (!currentUser) {
                alert('Please log in to view meal plans');
                return;
            }

            fetch('http://localhost:8000/api/meal_plans.php?user_id=1')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to load meal plans');
                    }
                    return response.json();
                })
                .then(mealPlans => {
                    // Clear existing meal slots
                    document.querySelectorAll('.meal-slot').forEach(slot => {
                        slot.innerHTML = '';
                    });

                    // Add meal plans to the grid
                    mealPlans.forEach(plan => {
                        const dayColumn = document.getElementById(plan.day);
                        const mealSlot = dayColumn.querySelector(`.meal-slot[data-meal="${plan.meal_type}"]`);
                        if (mealSlot) {
                            const mealContent = document.createElement('div');
                            mealContent.className = 'meal-content';
                            mealContent.innerHTML = `
                                ${plan.recipe_name}
                                <button class="delete-btn" onclick="deleteMeal(${plan.id})">Ã—</button>
                            `;
                            mealSlot.appendChild(mealContent);
                        }
                    });
                })
                .catch(error => {
                    console.error('Error loading meal plans:', error);
                    alert('Failed to load meal plans');
                });
        }

        // Add a meal to the plan
        function addMealToPlan() {
            const recipeName = document.getElementById('recipeSelect').value.trim();
            const day = document.getElementById('daySelect').value;
            const mealType = document.getElementById('mealTypeSelect').value;

            if (!recipeName) {
                alert('Please enter a recipe name');
                return;
            }

            const currentUser = localStorage.getItem('currentUser');
            if (!currentUser) {
                alert('Please log in to add meals to your plan');
                return;
            }

            fetch('http://localhost:8000/api/meal_plans.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    user_id: 1,
                    recipe_name: recipeName,
                    day: day,
                    meal_type: mealType
                })
            })
            .then(response => {
                if (!response.ok) {
                    return response.json().then(data => {
                        throw new Error(data.error || 'Failed to add meal to plan');
                    });
                }
                return response.json();
            })
            .then(data => {
                document.getElementById('recipeSelect').value = '';
                loadMealPlans();
            })
            .catch(error => {
                console.error('Error adding meal to plan:', error);
                alert(error.message);
            });
        }

        // Delete a meal from the plan
        function deleteMeal(mealId) {
            if (!confirm('Are you sure you want to delete this meal?')) return;

            fetch(`http://localhost:8000/api/meal_plans.php?action=delete&id=${mealId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        alert(data.error);
                    } else {
                        loadMealPlans();
                    }
                })
                .catch(error => console.error('Error deleting meal:', error));
        }
    </script>
</body>
</html> 